<template name="ingredientEditorForm">
  <div class="col-xs-11 col-xs-offset-1">
    {{#unless inFlyout}}
      {{#if hasPermissionInAreaTo 'edit stocks'}} Edit Stocks {{/if}}
    {{/unless}}
  </div>

  <div class="ingredient-editor">
    <form class="form-horizontal submit-ingredient-form">
      <div class="form-group">
        <label class="col-sm-12 control-label">Supplier's Code</label>

        {{#if hasPermissionInAreaTo 'edit stocks'}}
        {{else}}
          <div class="form-control">{{ingredient.code}}</div>
        {{/if}}

        <div class="col-sm-12">
          {{#if hasPermissionInAreaTo 'edit stocks'}}
            <input type="text" name="code" class="form-control" placeholder="Add Code"
                   value="{{ingredient.code}}">
          {{else}}
            <div class="form-control">{{ingredient.code}}</div>
          {{/if}}
        </div>
      </div>

      <div class="form-group">
        <label class="col-sm-12 control-label">Name</label>

        <div class="col-sm-12">
          {{#if hasPermissionInAreaTo 'edit stocks'}}
            <input type="text" name="name" class="form-control" placeholder="Add Name"
                   value="{{ingredient.description}}">
          {{else}}
            <div class="form-control">{{ingredient.description}}</div>
          {{/if}}
        </div>
      </div>

      <div class="form-group">
        <label class="col-sm-12 control-label">Supplier</label>

        <div class="col-sm-12">
          {{#if hasPermissionInAreaTo 'edit stocks'}}
            <select name="supplier" class="form-control">
              {{#each supplierOptions}}
                <option {{suppliersOptionAttrs}}>{{name}}</option>
              {{/each}}
            </select>
          {{else}}
            <div class="form-control">
              {{#if ingredient.suppliers}}
                {{supplierName ingredient.suppliers}}
              {{else}}
                Not assigned
              {{/if}}
            </div>
          {{/if}}
        </div>
      </div>

      <div class="form-group">
        <label class="col-sm-12 control-label">
          Unit Ordered
          <i class="fa fa-question-circle unit-ordered-popover btn-link" data-toggle="popover"
             data-placement="top" data-trigger="focus" tabindex="0" role="button"></i>
        </label>

        <div class="col-sm-12">
          {{#if hasPermissionInAreaTo 'edit stocks'}}
            <input type="text" name="unitOrdered" class="form-control" placeholder="Type a unit"
                   value="{{ingredient.portionOrdered}}"/>
          {{else}}
            <div class="form-control">{{defaultValue ingredient.portionOrdered '-'}}</div>
          {{/if}}
        </div>
      </div>

      <div class="form-group">
        <label class="col-sm-12 control-label">How much does each {{unitsCaptions.ordered}} cost?</label>

        <div class="col-sm-12">
          {{#if hasPermissionInAreaTo 'edit stocks'}}
            <div class="input-group">
              <span class="input-group-addon">$</span>
              <input type="text" name="costPerPortion" class="form-control"
                     placeholder="How much does each {{unitsCaptions.ordered}} cost?"
                     value="{{ingredient.costPerPortion}}">
            </div>
          {{else}}
            <div class="form-control">${{ingredient.costPerPortion}}</div>
          {{/if}}
        </div>
      </div>

      <div class="form-group">
        <label class="col-sm-12 control-label">
          Unit Used
          <i class="fa fa-question-circle btn-link unit-used-popover" data-toggle="popover"
             data-placement="top" data-trigger="focus" tabindex="0" role="button"></i>
        </label>

        <div class="col-sm-12">
          {{#if hasPermissionInAreaTo 'edit stocks'}}
            <input type="text" name="unitUsed" placeholder="Type a unit" class="form-control"
                   value="{{ingredient.portionUsed}}"/>
          {{else}}
            <div class="form-control">{{defaultValue ingredient.portionUsed '-'}}</div>
          {{/if}}
        </div>
      </div>

      <div class="form-group">
        <label class="col-sm-12 control-label">
          How many {{unitsCaptions.used}} are there in a {{unitsCaptions.ordered}}?
          <i class="fa fa-question-circle btn-link unit-size-popover" data-toggle="popover"
             data-placement="top" data-trigger="focus" tabindex="0" role="button"></i>
        </label>

        <div class="col-sm-12">
          {{#if hasPermissionInAreaTo 'edit stocks'}}
            <input type="text" name="unitSize" class="form-control" placeholder="Unit Size"
                   value="{{ingredient.unitSize}}">
          {{else}}
            <div class="form-control">{{ingredient.unitSize}}</div>
          {{/if}}
        </div>
      </div>

      {{> ingredientEditorRelatedJobs ingredient}}

      <button type="submit" class="hide submit-form-button">save</button>
    </form>
    <div class="pull-right">
      {{#if editMode}} <!-- is edit mode -->
        <button type="button" class="btn btn-primary submit-ingredient-button">Save changes</button>
        {{#if isArchive}}
          <button type="button" class="btn btn-warning restore-button">Restore</button>
          <button type="button" class="btn btn-danger delete-button">Delete</button>
        {{else}}
          <button type="button" class="btn btn-warning archive-button">Archive</button>
        {{/if}}
      {{else}} <!-- create mode -->
        <button class="btn btn-primary submit-ingredient-button">Add ingredient</button>
      {{/if}}
      <button type="button" class="btn btn-default cancel-button">Cancel</button>
    </div>

    {{#if ingredient._id}}
      <div class="related-items-widget">
        {{> relatedItemsWidget referenceId=ingredient._id type="ingredient"}}
      </div>
    {{/if}}
  </div>
</template>